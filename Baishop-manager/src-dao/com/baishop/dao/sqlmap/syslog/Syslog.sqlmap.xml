<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Syslog" >

  <resultMap id="resultMap" class="com.baishop.entity.ass.Syslog" >
    <result column="id" property="id" jdbcType="BIGINT" />
    <result column="user" property="user" jdbcType="VARCHAR" />
    <result column="source" property="source" jdbcType="TINYINT" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="method" property="method" jdbcType="VARCHAR" />
    <result column="args" property="args" jdbcType="VARCHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="date" property="date" jdbcType="TIMESTAMP" />
  </resultMap>
  
  
  <sql id="select_where_clause" >
    <dynamic prepend="where">
		<isNotEmpty prepend="AND" property="id">
			id = #id:BIGINT#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="user">
			user = #user:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="source">
			source = #source:TINYINT#
		</isNotEmpty>		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[ 
			date >= #startDate:TIMESTAMP#
			]]> 
		</isNotEmpty>		
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[ 
			date <= #endDate:TIMESTAMP#
			]]> 
		</isNotEmpty>	
		
		<!-- 网站关键字查询 -->
		<isNotEmpty prepend="and" property="searchKey" close=")" open="(">
			user like CONCAT('%',#searchKey:VARCHAR#,'%') or 
			type like CONCAT('%',#searchKey:VARCHAR#,'%') or 
			method like CONCAT('%',#searchKey:VARCHAR#,'%') or 
			description like CONCAT('%',#searchKey:VARCHAR#,'%')
		</isNotEmpty>
	</dynamic>
  </sql>
  
  <sql id="select_sort_limit_clause" >
    <dynamic prepend="order by" >
      <isNotEmpty property="sort" >
        $sort$
      </isNotEmpty>
	  <isEmpty property="sort" >
	    date desc
	  </isEmpty>
    </dynamic>
	<dynamic prepend="limit">
		<isNotNull property="start">
			$start$,
			<isNotNull property="limit">
				$limit$
			</isNotNull>
			<isNull property="limit">
				18446744073709551615
			</isNull>
		</isNotNull>
	</dynamic>
  </sql>
  
  
  <select id="getSyslog" resultMap="resultMap" parameterClass="hashmap" >
    select id, user, source, type, method, args, description, date
    from syslog
	<include refid="select_where_clause" />
	<include refid="select_sort_limit_clause" />
  </select>
  
  <select id="getSyslogCount" resultClass="long" parameterClass="hashmap" >
    select count(0)
    from syslog
	<include refid="select_where_clause" />
  </select>
  
    
  <insert id="addSyslog" parameterClass="com.baishop.entity.ass.Syslog" >
    insert into syslog
    <dynamic prepend="(" >
      <isNotNull prepend="," property="user" >
        user
      </isNotNull>
      <isNotNull prepend="," property="source" >
        source
      </isNotNull>
      <isNotNull prepend="," property="type" >
        type
      </isNotNull>
      <isNotNull prepend="," property="method" >
        method
      </isNotNull>
      <isNotNull prepend="," property="args" >
        args
      </isNotNull>
      <isNotNull prepend="," property="description" >
        description
      </isNotNull>
      <isNotNull prepend="," property="date" >
        date
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="user" >
        #user:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="source" >
        #source:TINYINT#
      </isNotNull>
      <isNotNull prepend="," property="type" >
        #type:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="method" >
        #method:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="args" >
        #args:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="description" >
        #description:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="date" >
        #date:TIMESTAMP#
      </isNotNull>
      )
    </dynamic>
    <selectKey resultClass="java.lang.Long" keyProperty="id" >
      SELECT LAST_INSERT_ID()
    </selectKey>
  </insert>

</sqlMap>